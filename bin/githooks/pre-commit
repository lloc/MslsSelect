#!/bin/bash

echo ""
echo "phpcbf pre commit hook start"

PHPCBF="vendor/bin/phpcbf"

# check if phpcbf is installed as a composer dependency
if [ -x "$PHPCBF" ]; then
  # gets a list of all staged but not deleted php-files
  CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACMRTUXB HEAD | grep '\.php$')

  if [ -n "$CHANGED_FILES" ]; then
    # runs phpcbf on the changed files
    "$PHPCBF" -w $CHANGED_FILES
    # adds the changed files to staging again
    git add $CHANGED_FILES
  fi
fi

echo "phpcbf pre commit hook finish"
echo ""
